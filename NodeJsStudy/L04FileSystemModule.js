//ëª¨ë“ˆ : í”„ë¡œê·¸ë¨ì„ êµ¬ì„±í•˜ëŠ” êµ¬ì„± ìš”ì†Œë¡œ, ê´€ë ¨ëœ ë°ì´í„°ì™€ í•¨ìˆ˜ë¥¼ í•˜ë‚˜ë¡œ ë¬¶ì€ ë‹¨ìœ„
//      ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ë‚˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë“±.. (ê°œë°œìì— ì˜í•´ ìƒìƒëœ ê°€ì¥ ì‘ì€ ë‹¨ìœ„)
//ë¼ì´ë¸ŒëŸ¬ë¦¬ : í•„ìš”ì— ì˜í•´ì„œ ì‚¬ìš©ë˜ëŠ” ê°ì²´
//ì–´í”Œë¦¬ì¼€ì´ì…˜ : ìœ ì €ì—ê²Œ ì„œë¹„ìŠ¤ ë˜ëŠ” ê²ƒ
//íŒ¨í‚¤ì§€ : ìœ ì‚¬í•œ ì‚¬ìš©ì„ ìœ„í•´ ëª¨ì¸ ê°ì²´ì˜ ì§‘ë‹¨ (Ex) Collection FrameWork : List, Map, Set, Date..)
//í”„ë ˆì„ì›Œí¬ : ëª¨ë“ˆì„ ì œì–´í•˜ê³  í”„ë¡œê·¸ë˜ë° ì‹œ í”„ë ˆì„ì›Œí¬ì˜ ê·œì¹™ì— ë”°ë¥¼ ë•Œ í”„ë ˆì„ì›Œí¬ë¼ í•œë‹¤.
//          ì—¬ëŸ¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ì§‘ë‹¨ìœ¼ë¡œ íŠ¹ì • ì„œë¹„ìŠ¤ê°€ ê°€ì§„ í•œê³„ë¥¼ ë²—ì–´ë‚˜ê¸° ìœ„í•´ ê·¸ ì„œë¹„ìŠ¤ ì „ì²´ë¥¼ ì œì–´í•˜ëŠ” ë‹¨ìœ„
//ğŸ–±ï¸) í”„ë ˆì„ì›Œí¬ëŠ” ì–´ë– í•œ ëª©ì ì„ ë‹¬ì„±í•˜ê¸° ìœ„í•´ ë³µì¡í•˜ê²Œ ì–½í˜€ìˆëŠ” ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ êµ¬ì¡°ë©°, ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œì— ìˆì–´ í•˜ë‚˜ì˜ ë¼ˆëŒ€ ì—­í• ì„ í•œë‹¤.
//spring :  í†°ìº£ì´ ê°€ì§„ ë¶ˆì•ˆì„±ê³¼ ê°ì²´ì§€í–¥ì˜ í•œê³„ë¥¼ ë²—ì–´ë‚˜ê¸° ìœ„í•´ ê´€ì ì§€í–¥ì„ ì ìš©í•˜ëŠ” í”„ë ˆì„ì›Œí¬
//expressjs : node jsê°€ ê°–ëŠ” ë¶ˆí¸í•¨(ëª¨ë“  ê±¸ ë‹¤ êµ¬í˜„í•´ì•¼í•¨)ì„ í•´ì†Œí•˜ê³  ë¯¸ë“¤ì›¨ì–´ë¥¼ ì ìš©í•˜ëŠ” í”„ë ˆì„ì›Œí¬
//spring ì•ˆì—ëŠ” í†°ìº£ì´ í¬í•¨ë˜ì–´ìˆê³  express ì•ˆì— node ê°€ ìˆì§€ë§Œ ë¬¸ë²•ì€ ë‹¤ë¦„.
//í”„ë ˆì„ì›Œí¬ì˜ ë‹¨ì  : ë°°ìš°ê¸° ì–´ë µë‹¤. ì‘ì€ ì„œë¹„ìŠ¤ì— ì ìš©í•˜ê¸° ì–´ë µë‹¤.

//node js : ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ì„œë²„ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì–¸ì–´,nodejsëŠ” NodejsPackageManager(NPM:) ì„ ì œê³µí•˜ê³  ìˆë‹¤.
//        : nodejsëŠ” ëª…í™•í•˜ê²Œ ë§í•˜ë©´ ì„œë²„ê°€ ì•„ë‹ˆë‹¤. (ì„œë²„ì–¸ì–´: ë™ì í˜ì´ì§€ì— ì ìš©ë˜ëŠ” ì–¸ì–´ (ì„œë¸”ë¦¿=>ìë°”)
//         ì„œë²„ì–¸ì–´ì´ê¸°ë„ í•˜ê³  ì„œë²„ë¥¼ êµ¬í˜„í•  ìˆ˜ë„ ìˆë‹¤.

const http=require("http");
const url=require("url");// urlì—ì„œ pathì™€ queryStringì„ ë¶„ë¦¬
const querySting =require("querystring");//queryStringì„ Objectë¡œ ë³€í™˜
const fs =require("fs");// javaì˜ FileReader+Writerì™€ ìœ ì‚¬ (íŒŒì¼ì„ ë¬¸ìì—´ë¡œ ë¶ˆëŸ¬ì˜¤ëŠ”ê²ƒ)
const fsPromise=require("fs/promises"); // fsì„ í”„ë¼ë¯¸ìŠ¤í™” í•œ ê²ƒ.

const server=http.createServer();//nodejsë¡œ êµ¬í˜„í•œ ì„œë²„ (=í†°ìº£ì´ í•˜ëŠ”ì¼)
server.listen(8888);//í´ë¼ì´ì–¸íŠ¸ì—ì„œ í•´ë‹¹ ì„œë²„ì— ìš”ì²­ì´ ë“¤ì–´ì˜¬ ë•Œë§ˆë‹¤ ìš”ì²­ ì´ë²¤íŠ¸ë¥¼ ì‹¤í–‰

//ğŸ˜ ì•”ê¸°!
//  urlëŠ” ì„œë²„ì£¼ì†Œ+íŒ¨ìŠ¤+ì¿¼ë¦¬ìŠ¤íŠ¸ë§ ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ìˆë‹¤.
//  www.naver.com  :ì„œë²„ì£¼ì†Œ(=ë„ë©”ì¸) 127.3.0.13:80 ip(internet protocol:ì¸í…Œë„·ìƒì—ì„œ ì»´í“¨í„°ê°€ê°–ëŠ” ê³ ìœ ì£¼ì†Œ)+port ë¥¼ ë§µí•‘í•˜ëŠ” ì£¼ì†Œ
//  /book/detail.do : íŒ¨ìŠ¤ or pathname: í•´ë‹¹ì„œë²„ì—ì„œ ê³µê°œë˜ê³  ìˆëŠ” ë¦¬ì†ŒìŠ¤ì˜ ì£¼ì†Œ
//  ?bid=12313k1 : ì¿¼ë¦¬ìŠ¤íŠ¸ë§ : í•´ë‹¹ ë™ì  ë¦¬ìŠ¤ì†Œì— ì œê³µí•˜ëŠ” íŒŒë¼ë¯¸í„°ë“¤ (&ë¡œ ì—°ê²°)

server.on("request",async (req, res)=>{//on(request,()=>{}) ìš”ì²­ì´ë²¤íŠ¸ ì‹¤í–‰


    const urlObj=url.parse(req.url);// const urlParse ë¼ê³  í•´ë„ë¨.
    const params=querySting.parse(urlObj.query);//íŒŒë¼ë¯¸í„° ë¶„ë¦¬
    const urlSplits=urlObj.pathname.split("/");//ğŸ’
    console.log(urlSplits);//cë¥¼ í´ë¦­ì‹œ [ '', 'public', 'html', 'c.html' ] ê°€ëœ¬ë‹¤.
    //ğŸ’ urlì— íŒ¨ìŠ¤ì— /public/ ì´ í¬í•¨ë˜ë©´ ëª¨ë‘ ì •ì  ë¦¬ì†ŒìŠ¤ë‹¤ ë¼ê³  ì•½ì†! (publicìœ¼ë¡œ ë³´ë‚¸ë‹¤)
    //ì˜ˆë¥¼ë“¤ì–´ /public/css/a.cssë¥¼ ìš”ì²­í•œë‹¤í•˜ë©´ /ë¥¼ ì˜ë¼ë‚´ì–´ 1ë²ˆì§¸ê°€ public ì´ë©´ ì •ì ë¦¬ì†ŒìŠ¤ì´ê¸° ë•Œë¬¸ì— publicìœ¼ë¡œ ë³´ë‚¸ë‹¤.
    //        /public/html/c.html
    if(urlSplits[1]==="public") {//ğŸ’ì •ì  ë¦¬ì†ŒìŠ¤ë¥¼ ìš”ì²­í•¨
        if(urlSplits[2]==="html"){
            res.setHeader("content-type","text/html;charset=UTF-8");
        }else if(urlSplits[2]==="css"){
            res.setHeader("content-type","text/css;");
        }else if(urlSplits[2]==="img"){
            res.setHeader("content-type","image/jpeg;");//pngë„ jpegë¡œ ë¶ˆëŸ¬ì˜¬ìˆ˜ìˆìŒ.
        }else if(urlSplits[2]==="js"){
            res.setHeader("content-type","application/javascript;");
        }


/*   //ì„œë²„ ë‚´ë¶€ì—ì„œ / ë¡œ ìµœìƒìœ„ ìƒëŒ€ì£¼ì†Œë¥¼ ì“°ë©´ c://(window) or user(mac) í•˜ìœ„ë¡œ ì°¾ì•„ê°„ë‹¤. ë•Œë¬¸ì— ìƒëŒ€ì£¼ì†Œë¡œ ì¨ì•¼í•œë‹¤.
       fs.readFile("."+urlObj.pathname,(err,data)=>{
            if(err) {
                console.error(err);
                res.write("<h1>500 íŒŒì¼ ìš”ì²­ì„ ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.</h1>");
                res.end();
                //return;
            }
            res.write(data);
            res.end();
        });

 */

        try{//ìœ„ì˜ ì£¼ì„ì²˜ë¦¬í•œ ì½œë°±í•¨ìˆ˜ë¥¼ í”„ë¼ë¯¸ìŠ¤í™” í•¨ìˆ˜ë¡œ ë³€í™˜.
            let data = await fsPromise.readFile("."+urlObj.pathname,);//ê°€ì¥ ì¸ì ‘í•œ í•¨ìˆ˜ê°€ async í•¨ìˆ˜ì—¬ì•¼ awaitë¥¼ ì“¸ìˆ˜ìˆë‹¤.
            res.write(data);
            res.end();
        }catch (e) {
            console.error(e);
            res.statusCode=500;
            res.write("<h1>500 íŒŒì¼ ìš”ì²­ì„ ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.</h1>");
            res.end();
        }

    }else{//ğŸ’ ë™ì  ë¦¬ì†ŒìŠ¤ë§Œ
        res.setHeader("content-type","text/html;charset=UTF-8");
        if(req.url =="/"){// ë™ì ë¦¬ì†ŒìŠ¤(==ì„œë¸”ë¦¿) //ë¦¬ì†ŒìŠ¤: ëˆ„êµ°ê°€ê°€ ì°¾ì„ ìˆ˜ìˆëŠ” ìë£Œ
            res.write("<h1>index í˜ì´ì§€ì…ë‹ˆë‹¤.</h1>");
            res.write("<h2>ì„œë²„ì˜ ë¦¬ì†ŒìŠ¤ ëª©ë¡</h2>");
            res.write(`
            <ul>
                <li><a href="/a.do">a.do ë™ì í˜ì´ì§€</a></li>
                <li><a href="a.do?a=11.3&b=30.333">
                      a+bë¥¼ ì—°ì‚°í•˜ëŠ” a.do ë™ì í˜ì´ì§€</a></li>
                <li><a href="b.html">b.html ì •ì í˜ì´ì§€</a></li>
                <li><a href="/public/html/c.html">c.html ì •ì  í˜ì´ì§€</a></li>
                <li><a href="/public/html/d.html">d.html ì •ì  í˜ì´ì§€</a></li>
                <li><a href="/public/css/d.css">d.css ìŠ¤íƒ€ì¼ì‹œíŠ¸</a></li>
                <li><a href="/public/img/d.jpeg">ì°¸ìƒˆì´ë¯¸ì§€</a></li>
            </ul>
        `);
            res.end();
        }else if (urlObj.pathname=="/a.do"){//a.do ë™ì ë¦¬ì†ŒìŠ¤
            let a = parseFloat(params.a);//ë¬¸ìì—´ì´ê¸° ë•Œë¬¸ì— ìˆ«ìë¡œ ë³€í™˜
            let b = parseFloat(params.b);
            res.write(`<h1>a.do í˜ì´ì§€ ì…ë‹ˆë‹¤.</h1>`);
            res.write(`<h2>ë°›ì•„ì˜¨ íŒŒë¼ë¯¸í„° aì™€ bë¥¼ + ì—°ì‚° : ${a+b}</h2>`);
            res.end();//ì‘ë‹µì„ ì™„ë£Œí•¨.(endë¥¼ ì•ˆì“°ë©´ í´ë¼ì´ì–¸íŠ¸ ì„œë²„ê°€ ì‘ë‹µí•˜ëŠ” ê²ƒì„ ë¬´í•œ ëŒ€ê¸° í•  ìˆ˜ ìˆë‹¤)

        }else if(urlObj.pathname=="/b.html"){
            fs.readFile('b.html',(err,data)=>{
                if(err) {
                    console.error(err);
                    //return;
                }
                res.write(data);
                res.end();
            });

            //ì—¬ê¸°ì— res.end();ë¥¼ ì“°ì§€ ì•ŠëŠ”ë‹¤.
            //readFileì´ ë©€í‹°ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•˜ê¸° ë•Œë¬¸ì— ë¹„ë™ê¸° ì½”ë“œì´ê¸° ë•Œë¬¸ì´ë‹¤.(ì½œë°±í•¨ìˆ˜ê°€ ë‹¤ ëë‚˜ê¸° ì „ ìš°ì„ ì‹¤í–‰ì´ ë  ìˆ˜ìˆë‹¤.)
        }
        else{
            res.statusCode=404;
            res.write("<h2>404 ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í˜ì´ì§€ì…ë‹ˆë‹¤.</h2>");
            res.end();
        }

    }


});
