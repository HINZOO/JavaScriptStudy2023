<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>fetch API ì™€ AJAX</title>
</head>
<body>
    <h1>ğŸ€ Promise í™” ëœ ë¹„ë™ê¸° í†µì‹  API fetch</h1>
    <h2>
        empListJson.do ì™€ ë¹„ë™ê¸°ì‹ í†µì‹ 
        <button onclick="loadEmpListJson()">ë¡œë“œ!</button>
    </h2>
    <pre id="empListCont"></pre>
    <script>
        function loadEmpListJson(){
            fetch("empListJson.do?deptno=10",{method:"GET"})
                .then((resp)=>{//ì‘ë‹µí•œ ë‚´ì—­ ì „ì²´ (ì‘ë‹µí•œ ë‚´ì—­ì„ ì–´ë–¤ í˜•ì‹ìœ¼ë¡œ ì²˜ë¦¬í• ì§€ ì •í•´ì•¼í•œë‹¤.
                    return resp.json();//ì‘ë‹µí•œ ë‚´ì—­ì„ JSON(ë¬¸ìì—´ê³¼ Objectë¡œ íŒŒì‹±ì²˜ë¦¬í•˜ëŠ”)ìœ¼ë¡œ promiseë¥¼ ë°˜í™˜)
                    //resp.text() // ì‘ë‹µí•œ ë‚´ì—­ì„ ë¬¸ìì—´ë¡œ ì²˜ë¦¬í•˜ëŠ” promiseë¥¼ ë°˜í™˜
                }).then((empList)=>{//Object ê°€ ëœ ê°’ì´ ë“¤ì–´ì˜´.
                empListCont.innerHTML=(empList);
            });
        }

        //fetch : promiseê°€ ë‚´ì¥ëœ í•¨ìˆ˜ , urlë¡œ í†µì‹ ì„ ì—°ê²°í•˜ê³  { }ë¡œ ì˜µì…˜ì„ ì¤„ ìˆ˜ ìˆë‹¤.
        // promise ê°€ ë‚´ì¥ë˜ì–´ìˆê¸° ë•Œë¬¸ì—  thenì„ ì“¸ìˆ˜ìˆë‹¤.
    </script>

    <h2>ğŸ“‚ XMLHttpRequestì˜ í”„ë¼ë¯¸ìŠ¤í™”</h2>
    <h3>
        <a href="javascript:void(0)" id="loadImgListBtn"> <!--ğŸ‘€ë§í¬ì´ë™ëª»í•˜ê²Œ ë§‰ì•„ë‘ -->
            ğŸ‘‰í”„ë¼ë¯¸ìŠ¤í™” í•œ í•¨ìˆ˜ë¡œ  ajax/imgList.html imgList ë¶ˆëŸ¬ì˜¤ê¸°
        </a>
    </h3>
    <div id="imgCont"></div>
    <script>
        loadImgListBtn.onclick=function (e){
            fetchApi("ajax/imgList.html")
                .then((responseText)=>{//ì•„ë˜ fetchApií•¨ìˆ˜ì—ì„œ resolve ì˜ ì²«ë²ˆì§¸ ì½œë°±í•¨ìˆ˜ê°€ ì˜´.
                    imgCont.innerHTML=responseText;
            }).catch((errMsg)=>{
                alert("í˜¸ì¶œ ì‹¤íŒ¨"+errMsg);// ì‹¤ì œ  fetchí•¨ìˆ˜ì—ëŠ” catchê°€ ì—†ë‹¤. ì¦‰ reject ë¥¼ ì •ì˜í•˜ì§€ ì•Šê³  ìˆë‹¤.
            });
        }
        function fetchApi(url,method="GET"){//ğŸ˜ fetchí•¨ìˆ˜ì™€ ê¸°ëŠ¥ì´ ê°™ì€ fetchApië€ ì´ë¦„ì˜ ê°€ìƒí•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ë³´ì
            return new Promise((resolve,reject)=>{
                const req= new XMLHttpRequest(); //req.readyState==0;
                req.open(method,url);//req.readyState==1;
                req.onload=function (e){
                    if(req.status==200){//200: ìš”ì²­ì´ ì„±ê³µí–ˆì„ ë•Œ
                        let responseText = req.responseText;
                        resolve(responseText);
                    }else{// 404 : ìš”ì²­í•œ url ë¦¬ì†ŒìŠ¤ê°€ ì—†ëŠ” ê²ƒ, 500 : ìš”ì²­í•œ ë¦¬ì†ŒìŠ¤ì— ì˜¤ë¥˜ê°€ ìˆëŠ” ìƒíƒœ
                        reject(new Error(req.status+""));
                    }
                }//í†µì‹ ì™„ë£Œ req.readyState==4; : ì‘ë‹µë°›ì€ ë‚´ì—­ì„ ëª¨ë‘ ì²˜ë¦¬ í–ˆì„ ë•Œ.

                req.send();
                //í†µì‹ ì‹œì‘ req.readyState==2; :// ì„œë²„ê°€ ì‘ë‹µ í•´ë”(ìƒíƒœ)ë¥¼ ë°›ì•˜ì„ ë•Œ
                //req.readyState==3; // ì„œë²„ì—ì„œ ëª¨ë“  ì‘ë‹µì„ ì™„ë£Œí–ˆì„ ë•Œ
            });
        }
    </script>

    <h3>
    [ê³¼ì œ] dept ë¦¬ìŠ¤íŠ¸ë¥¼ json ìœ¼ë¡œ ë°˜í™˜í•˜ëŠ” ì„œë¸”ë¦¿(L19EmpListJson ì°¸ê³ )ì„ ë§Œë“¤ê³  ajax ë¡œ í˜¸ì¶œí•˜ì„¸ìš”
    </h3>
    <p>
        <button>XMLHttpRequest ë¡œ í˜¸ì¶œ</button>
        <button>XMLHttpRequest ì˜ í”„ë¼ë¯¸ìŠ¤í™”ë¡œ í˜¸ì¶œ</button>
        <button>fetch ë¡œ í˜¸ì¶œ</button>
    </p>
    <table></table>

</body>
</html>