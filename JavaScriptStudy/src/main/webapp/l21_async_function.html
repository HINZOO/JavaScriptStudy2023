<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>async 함수</title>
</head>
<body>
    <h1>🎀 async 함수와 프라미스와 동기화!</h1>
    <h2>📂 async 함수</h2>
        <p>👉 async 함수는 자동 프라미스화 기능이 존재한다.(잘쓰진 않지만 알고있어야한다.)</p>

    <pre>
        async function name(){
            return data;
            == 같은의미 ===============
            new Promise ((resolve)=>{
                    resolve(data);
            })
            =========================
        }

    </pre>
    <p>👉 async 함수는 await 연산으로 Promise 객체의 then()함수를 실행할 수 있다.
        그리고 then의 첫번째 콜백함수의 매개변수를 반환한다.</p>
    <p>😎 콜백지옥을 벗어나기 위해 Promise(2015) 가 도입되었지만 프라미스 지옥을 안겨주었다..
        이를 해결하기 위해 async 함수가 등장!</p>
    <pre>
        new Promise((resolve)=>{
            ...처리
            resolve(결과);
        }).then((결과)=>{
            ...처리
        });
        ==같은의미===============
        async function name(){
            let 결과 = await new Promise((resolve)=>{
                ...처리
                resolve(결과);
            })
            ...처리 //await을 쓰면서 then의 역할을 해준다.
        }
    </pre>

<script>
    async function a(){
        return "1";
    }//실행시 promise 객체를 반환한다.
    console.log(a());
    a().then((msg)=>{
        console.log(msg);// then을 거쳐야 내가 원하는 값을 반환할 수있다. (본래 sync 함수는 promise를반환하기때문)
    });

    function a2(){// async 함수의 원래 모양.
        return new Promise((resolve)=>{resolve("1")})
    }//실행시 promise 객체를 반환한다.
    console.log(a2());
////////////////////////////
    function loadImgList(){
        fetch ("ajax/imgList.html")
            .then((resp)=>{
                return resp.text();
            }).then((html)=>{
            alert(html);
        });
    }

    async function loadImgListAsync(){
        const resp=await fetch("ajax/imgList.html");
            //await 함수를 실행하면 then()이 실행되고 then의 첫번째 콜백함수인 resp을 반환
        console.log(resp);
        const html = await resp.text();
            //그 다음에 오는 콜백함수를 실행하고 html을 반환한다.
        //await을 쓰면 (위의 await 이 붙은) 두개의 비동기 코드가 동기화 된다.
        alert(html);
    }
    loadImgListAsync();
</script>

</body>
</html>